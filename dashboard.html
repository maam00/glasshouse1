<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glass House ‚Äî $OPEN Intelligence</title>
    <meta name="description" content="Honest operational intelligence for Opendoor investors. No survivorship bias.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --green: #22c55e;
            --green-dim: rgba(34, 197, 94, 0.1);
            --amber: #f59e0b;
            --amber-dim: rgba(245, 158, 11, 0.1);
            --red: #ef4444;
            --red-dim: rgba(239, 68, 68, 0.1);
            --text: #ffffff;
            --text-2: #a0a0a0;
            --text-3: #666666;
            --text-4: #333333;
            --border: #1a1a1a;
            --surface: #0a0a0a;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #000;
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 760px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            margin-bottom: 40px;
            border-bottom: 1px solid var(--border);
        }

        .brand { font-size: 15px; font-weight: 600; }
        .header-right { display: flex; align-items: center; gap: 16px; font-size: 13px; color: var(--text-2); }
        .ticker { font-family: 'JetBrains Mono', monospace; }

        /* Section */
        .section {
            margin-bottom: 48px;
        }

        .section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-3);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        /* Split Panel */
        .split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .panel {
            background: var(--surface);
            border-radius: 8px;
            padding: 20px;
        }

        .panel-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-2);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .big-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 36px;
            font-weight: 600;
            line-height: 1;
            margin-bottom: 4px;
        }

        .big-label {
            font-size: 13px;
            color: var(--text-3);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px solid #111;
        }

        .stat-row:last-child { border-bottom: none; }
        .stat-label { color: var(--text-2); }
        .stat-value { font-family: 'JetBrains Mono', monospace; }

        .green { color: var(--green); }
        .amber { color: var(--amber); }
        .red { color: var(--red); }

        /* Exposure Box */
        .exposure {
            background: var(--surface);
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }

        .exposure-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-3);
            margin-bottom: 12px;
        }

        .exposure-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .exposure-item {
            text-align: center;
        }

        .exposure-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 600;
        }

        .exposure-label {
            font-size: 11px;
            color: var(--text-3);
            margin-top: 4px;
        }

        /* Progress */
        .progress-bar {
            height: 6px;
            background: var(--text-4);
            border-radius: 3px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }

        /* Table */
        .tbl {
            width: 100%;
            font-size: 13px;
            border-collapse: collapse;
        }

        .tbl th {
            text-align: left;
            padding: 10px 8px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-3);
            border-bottom: 1px solid var(--border);
        }

        .tbl td {
            padding: 12px 8px;
            border-bottom: 1px solid #111;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        .tbl tr:last-child td { border-bottom: none; }
        .tbl .name { font-family: 'Inter', sans-serif; font-weight: 500; }

        /* Velocity Grid */
        .velocity-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .velocity-day {
            background: var(--surface);
            border-radius: 6px;
            padding: 12px 8px;
            text-align: center;
        }

        .velocity-date {
            font-size: 10px;
            color: var(--text-3);
            margin-bottom: 6px;
        }

        .velocity-homes {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 600;
        }

        .velocity-rev {
            font-size: 11px;
            color: var(--text-2);
            margin-top: 4px;
        }

        /* Metrics Row */
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .metric-card {
            background: var(--surface);
            border-radius: 6px;
            padding: 14px;
            text-align: center;
        }

        .metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 600;
        }

        .metric-label {
            font-size: 10px;
            color: var(--text-3);
            margin-top: 4px;
            text-transform: uppercase;
        }

        /* Disclaimer */
        .disclaimer {
            background: #0d0d0d;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-top: 48px;
        }

        .disclaimer-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--amber);
            margin-bottom: 12px;
        }

        .disclaimer-text {
            font-size: 12px;
            color: var(--text-2);
            line-height: 1.6;
        }

        .disclaimer-text strong {
            color: var(--text);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 0 24px;
            border-top: 1px solid var(--border);
            margin-top: 48px;
        }

        .footer-brand { font-size: 14px; font-weight: 600; margin-bottom: 6px; }
        .footer-sub { font-size: 12px; color: var(--text-3); }

        /* Screenshot Mode Button */
        .screenshot-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-2);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .screenshot-btn:hover {
            background: #1a1a1a;
            color: var(--text);
        }

        .screenshot-btn.active {
            background: var(--green-dim);
            border-color: var(--green);
            color: var(--green);
        }

        /* Screenshot Mode */
        body.screenshot-mode header,
        body.screenshot-mode footer,
        body.screenshot-mode .disclaimer {
            display: none !important;
        }

        body.screenshot-mode {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        body.screenshot-mode .container {
            max-width: 1280px;
            width: 100%;
            aspect-ratio: 16 / 9;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        body.screenshot-mode .section {
            margin-bottom: 24px;
        }

        .watermark {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-3);
            opacity: 0.6;
            letter-spacing: 1px;
        }

        body.screenshot-mode .watermark {
            display: block;
        }

        /* Collapsible Sections */
        .collapsible {
            margin-bottom: 48px;
        }

        .collapse-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .collapse-header:hover .section-title {
            color: var(--text-2);
        }

        .collapse-arrow {
            font-size: 12px;
            color: var(--text-3);
            transition: transform 0.3s ease;
            margin-left: 8px;
        }

        .collapsible.collapsed .collapse-arrow {
            transform: rotate(-90deg);
        }

        .collapse-content {
            overflow: hidden;
            max-height: 1000px;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .collapsible.collapsed .collapse-content {
            max-height: 0;
            opacity: 0;
        }

        .collapse-preview {
            display: none;
            padding: 12px 0;
            font-size: 13px;
            color: var(--text-2);
        }

        .collapsible.collapsed .collapse-preview {
            display: block;
        }

        /* WoW Delta Badges */
        .delta {
            font-size: 11px;
            margin-left: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
        }

        .delta.positive {
            color: var(--green);
        }

        .delta.negative {
            color: var(--red);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .split { grid-template-columns: 1fr; }
            .velocity-grid { grid-template-columns: repeat(3, 1fr); }
            .metrics-row { grid-template-columns: repeat(2, 1fr); }
            .exposure-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- Header -->
    <header>
        <div class="brand">Glass House</div>
        <div class="header-right">
            <button class="screenshot-btn" id="screenshot-btn" onclick="toggleScreenshotMode()">üì∑ Screenshot Mode</button>
            <span class="ticker">$OPEN $5.90</span>
            <span id="date">Jan 27, 2026</span>
        </div>
    </header>

    <!-- Watermark for Screenshot Mode -->
    <div class="watermark">Glass House</div>

    <!-- KAZ-ERA HEALTH -->
    <section class="section">
        <div class="section-title">Kaz-Era Portfolio (Acquired Nov 2025+)</div>

        <div class="split">
            <div class="panel">
                <div class="panel-title">Sold</div>
                <div class="big-num" id="kaz-sold-count">66</div>
                <div class="big-label">homes closed</div>
                <div style="margin-top: 16px;">
                    <div class="stat-row">
                        <span class="stat-label">Win Rate</span>
                        <span><span class="stat-value green" id="kaz-sold-wr">98.5%</span><span class="delta positive" id="kaz-wr-delta">+0.5% WoW</span></span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Profit</span>
                        <span><span class="stat-value green" id="kaz-sold-profit">$44.4K</span><span class="delta positive" id="kaz-profit-delta">+$2.1K WoW</span></span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Realized</span>
                        <span class="stat-value" id="kaz-sold-total">+$2.9M</span>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">Still Listed</div>
                <div class="big-num" id="kaz-listed-count">145</div>
                <div class="big-label">homes on market</div>
                <div style="margin-top: 16px;">
                    <div class="stat-row">
                        <span class="stat-label">Above Water</span>
                        <span class="stat-value green" id="kaz-listed-above">85.5% (124)</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Underwater</span>
                        <span><span class="stat-value red" id="kaz-listed-uw">3.4% (5)</span><span class="delta negative" id="kaz-uw-delta">+1 WoW</span></span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">With Price Cuts</span>
                        <span class="stat-value amber" id="kaz-listed-cuts">38.6% (56)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="exposure">
            <div class="exposure-title">Kaz-Era Net Position</div>
            <div class="exposure-grid">
                <div class="exposure-item">
                    <div class="exposure-num green" id="kaz-realized">+$2.9M</div>
                    <div class="exposure-label">Realized Gains</div>
                </div>
                <div class="exposure-item">
                    <div class="exposure-num" id="kaz-unrealized">+$6.8M</div>
                    <div class="exposure-label">Unrealized (Above)</div>
                </div>
                <div class="exposure-item">
                    <div class="exposure-num red" id="kaz-uw-exposure">-$27K</div>
                    <div class="exposure-label">Underwater Exposure</div>
                </div>
            </div>
        </div>
    </section>

    <!-- LEGACY CLEANUP -->
    <section class="section">
        <div class="section-title">Legacy Portfolio (Pre-Kaz)</div>

        <div class="split">
            <div class="panel">
                <div class="panel-title">Sold</div>
                <div class="big-num" id="legacy-sold-count">118</div>
                <div class="big-label">homes closed</div>
                <div style="margin-top: 16px;">
                    <div class="stat-row">
                        <span class="stat-label">Win Rate</span>
                        <span><span class="stat-value amber" id="legacy-sold-wr">55.9%</span><span class="delta positive" id="legacy-wr-delta">+1.2% WoW</span></span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Profit</span>
                        <span class="stat-value" id="legacy-sold-profit">$13.8K</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Realized</span>
                        <span class="stat-value" id="legacy-sold-total">+$1.6M</span>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">Still Listed</div>
                <div class="big-num" id="legacy-listed-count">455</div>
                <div class="big-label">homes on market</div>
                <div style="margin-top: 16px;">
                    <div class="stat-row">
                        <span class="stat-label">Above Water</span>
                        <span class="stat-value" id="legacy-listed-above">39.1% (178)</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Underwater</span>
                        <span><span class="stat-value red" id="legacy-listed-uw">40.4% (184)</span><span class="delta positive" id="legacy-uw-delta">-8 WoW</span></span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">With Price Cuts</span>
                        <span class="stat-value red" id="legacy-listed-cuts">99.6% (453)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="exposure">
            <div class="exposure-title">Legacy Exposure</div>
            <div class="exposure-grid">
                <div class="exposure-item">
                    <div class="exposure-num red" id="legacy-uw-exposure">-$4.95M</div>
                    <div class="exposure-label">Underwater Exposure<span class="delta positive" id="exposure-delta">+$120K WoW</span></div>
                </div>
                <div class="exposure-item">
                    <div class="exposure-num" id="legacy-toxic-remaining">84</div>
                    <div class="exposure-label">Toxic Remaining<span class="delta positive" id="toxic-delta">-5 WoW</span></div>
                </div>
                <div class="exposure-item">
                    <div class="exposure-num" id="legacy-weeks">~9 wks</div>
                    <div class="exposure-label">To Clear</div>
                </div>
            </div>
        </div>
    </section>

    <!-- VELOCITY -->
    <section class="section">
        <div class="section-title">Daily Velocity</div>

        <div class="velocity-grid" id="velocity-grid">
            <div class="velocity-day">
                <div class="velocity-date">Jan 27</div>
                <div class="velocity-homes">0</div>
                <div class="velocity-rev">$0</div>
            </div>
            <div class="velocity-day">
                <div class="velocity-date">Jan 26</div>
                <div class="velocity-homes">12</div>
                <div class="velocity-rev">$4.2M</div>
            </div>
            <div class="velocity-day">
                <div class="velocity-date">Jan 25</div>
                <div class="velocity-homes">18</div>
                <div class="velocity-rev">$6.8M</div>
            </div>
            <div class="velocity-day">
                <div class="velocity-date">Jan 24</div>
                <div class="velocity-homes">15</div>
                <div class="velocity-rev">$5.5M</div>
            </div>
            <div class="velocity-day">
                <div class="velocity-date">Jan 23</div>
                <div class="velocity-homes">22</div>
                <div class="velocity-rev">$8.1M</div>
            </div>
        </div>

        <div class="metrics-row">
            <div class="metric-card">
                <div class="metric-value" id="vel-7day-homes">15.2</div>
                <div class="metric-label">Homes/Day (7d)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="vel-7day-rev">$4.6M</div>
                <div class="metric-label">Revenue/Day (7d)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value amber" id="vel-q1-proj">$410M</div>
                <div class="metric-label">Q1 Projected</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="vel-q1-target">$595M</div>
                <div class="metric-label">Q1 Guidance</div>
            </div>
        </div>

        <div class="progress-bar" style="margin-top: 20px;">
            <div class="progress-fill" id="q1-progress" style="width: 20%; background: var(--amber);"></div>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-3); margin-top: 8px;">
            <span><span id="q1-rev">$119.7M</span> revenue</span>
            <span><span id="q1-pct">20.1%</span> of guidance ‚Ä¢ Behind pace</span>
        </div>
    </section>

    <!-- SALES VELOCITY BY COHORT -->
    <section class="section">
        <div class="section-title">Sales Velocity by Cohort</div>

        <table class="tbl">
            <thead>
                <tr>
                    <th>Cohort</th>
                    <th>Sold</th>
                    <th>Avg Days</th>
                    <th>Median</th>
                </tr>
            </thead>
            <tbody id="velocity-cohort-table">
                <tr><td class="name">New (&lt;90d)</td><td>72</td><td class="green">34</td><td>28</td></tr>
                <tr><td class="name">Mid (90-180d)</td><td>104</td><td>127</td><td>118</td></tr>
                <tr><td class="name">Old (180-365d)</td><td>100</td><td class="amber">245</td><td>230</td></tr>
                <tr><td class="name">Toxic (&gt;365d)</td><td>43</td><td class="red">485</td><td>462</td></tr>
            </tbody>
        </table>

        <div style="margin-top: 16px; font-size: 13px; color: var(--text-2);">
            Good homes sell fast. Toxic homes sit for 400+ days ‚Äî proves the cohort stratification.
        </div>
    </section>

    <!-- CONTRIBUTION MARGIN BY COHORT -->
    <section class="section">
        <div class="section-title">Contribution Margin by Cohort</div>

        <table class="tbl">
            <thead>
                <tr>
                    <th>Cohort</th>
                    <th>Sold</th>
                    <th>Win Rate</th>
                    <th>Margin</th>
                    <th>Avg Profit</th>
                </tr>
            </thead>
            <tbody id="margin-cohort-table">
                <tr><td class="name">New (&lt;90d)</td><td>72</td><td class="green">90.3%</td><td class="green">11.2%</td><td class="green">$40.7K</td></tr>
                <tr><td class="name">Mid (90-180d)</td><td>104</td><td class="green">84.6%</td><td>8.4%</td><td>$36.9K</td></tr>
                <tr><td class="name">Old (180-365d)</td><td>100</td><td class="amber">53.0%</td><td>4.1%</td><td>$21.7K</td></tr>
                <tr><td class="name">Toxic (&gt;365d)</td><td>43</td><td class="red">30.2%</td><td class="red">-3.8%</td><td class="red">-$12.5K</td></tr>
            </tbody>
        </table>

        <div style="margin-top: 16px; font-size: 13px; color: var(--text-2);">
            Win rate tells part of the story. Margin shows profitability ‚Äî new cohort at 11%+ margin vs toxic at -4%.
        </div>
    </section>

    <!-- PRICE CUT SEVERITY -->
    <section class="section">
        <div class="section-title">Price Cut Severity (Leading Indicator)</div>

        <table class="tbl">
            <thead>
                <tr>
                    <th>Portfolio</th>
                    <th>1 Cut</th>
                    <th>2 Cuts</th>
                    <th>3+ Cuts</th>
                    <th>% With Cuts</th>
                    <th>Avg % Below</th>
                </tr>
            </thead>
            <tbody id="price-cut-table">
                <tr>
                    <td class="name">Kaz-Era</td>
                    <td id="cuts-kaz-1">40</td>
                    <td id="cuts-kaz-2">12</td>
                    <td id="cuts-kaz-3">4</td>
                    <td class="amber" id="cuts-kaz-pct">38.6%</td>
                    <td id="cuts-kaz-below">3.2%</td>
                </tr>
                <tr>
                    <td class="name">Legacy</td>
                    <td id="cuts-legacy-1">180</td>
                    <td id="cuts-legacy-2">150</td>
                    <td class="red" id="cuts-legacy-3">123</td>
                    <td class="red" id="cuts-legacy-pct">99.6%</td>
                    <td class="red" id="cuts-legacy-below">12.8%</td>
                </tr>
            </tbody>
        </table>

        <div style="margin-top: 16px; font-size: 13px; color: var(--text-2);">
            3+ cuts = distressed. 123 legacy homes have 3+ cuts. Kaz-era mostly at 1 cut ‚Äî healthy price discovery.
        </div>
    </section>

    <!-- KAZ-ERA UNDERWATER WATCHLIST -->
    <section class="collapsible collapsed" id="watchlist-section">
        <div class="collapse-header" onclick="toggleSection('watchlist-section')">
            <div class="section-title" style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">
                Kaz-Era Underwater Watchlist
                <span class="collapse-arrow">‚ñº</span>
            </div>
        </div>
        <div class="collapse-preview">
            <span id="uw-count-preview">5</span> underwater homes ‚Ä¢ Total exposure: <span class="red">-$47.2K</span> ‚Ä¢ Click to expand
        </div>
        <div class="collapse-content">
            <div class="section-title" style="border-bottom: 1px solid var(--border); margin-top: 12px;"></div>
            <div style="font-size: 13px; color: var(--text-2); margin-bottom: 16px;">
                These <span id="uw-count">5</span> homes are the canary. Watch for deterioration.
            </div>

            <table class="tbl">
                <thead>
                    <tr>
                        <th>Location</th>
                        <th>DOM</th>
                        <th>Underwater</th>
                        <th>Cuts</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="underwater-watchlist">
                    <tr><td class="name">Phoenix, AZ</td><td>45</td><td class="red">-$8.2K</td><td>1</td><td class="amber">Watching</td></tr>
                    <tr><td class="name">Dallas, TX</td><td>62</td><td class="red">-$12.1K</td><td>2</td><td class="red">Concern</td></tr>
                    <tr><td class="name">Atlanta, GA</td><td>38</td><td class="red">-$5.4K</td><td>1</td><td class="amber">Watching</td></tr>
                    <tr><td class="name">Tampa, FL</td><td>71</td><td class="red">-$18.3K</td><td>2</td><td class="red">Concern</td></tr>
                    <tr><td class="name">Charlotte, NC</td><td>29</td><td class="red">-$3.2K</td><td>0</td><td>Watching</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- GEOGRAPHIC RISK -->
    <section class="collapsible collapsed" id="geo-section">
        <div class="collapse-header" onclick="toggleSection('geo-section')">
            <div class="section-title" style="margin-bottom: 0; border-bottom: none; padding-bottom: 0;">
                Geographic Risk
                <span class="collapse-arrow">‚ñº</span>
            </div>
        </div>
        <div class="collapse-preview">
            Top risk: <span class="red">FL (48.2%)</span>, <span class="red">GA (44.1%)</span> ‚Ä¢ 5 states tracked ‚Ä¢ Click to expand
        </div>
        <div class="collapse-content">
            <div class="section-title" style="border-bottom: 1px solid var(--border); margin-top: 12px;"></div>
            <table class="tbl">
                <thead>
                    <tr>
                        <th>State</th>
                        <th>Inventory</th>
                        <th>Underwater</th>
                        <th>UW Rate</th>
                        <th>Risk</th>
                    </tr>
                </thead>
                <tbody id="geo-table">
                    <tr>
                        <td class="name">NC</td>
                        <td>127</td>
                        <td>38</td>
                        <td class="amber">29.9%</td>
                        <td class="amber">Medium</td>
                    </tr>
                    <tr>
                        <td class="name">GA</td>
                        <td>102</td>
                        <td>45</td>
                        <td class="red">44.1%</td>
                        <td class="red">High</td>
                    </tr>
                    <tr>
                        <td class="name">TX</td>
                        <td>89</td>
                        <td>22</td>
                        <td class="amber">24.7%</td>
                        <td class="amber">Medium</td>
                    </tr>
                    <tr>
                        <td class="name">FL</td>
                        <td>85</td>
                        <td>41</td>
                        <td class="red">48.2%</td>
                        <td class="red">High</td>
                    </tr>
                    <tr>
                        <td class="name">AZ</td>
                        <td>59</td>
                        <td>12</td>
                        <td>20.3%</td>
                        <td>Low</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- DAILY REVENUE CHART -->
    <section class="section">
        <div class="section-title">Daily Revenue (Last 14 Days)</div>
        <div id="revenue-chart" style="width:100%;height:250px;"></div>
    </section>

    <!-- TOXIC COUNTDOWN CHART -->
    <section class="section">
        <div class="section-title">Toxic Inventory Countdown</div>
        <div id="toxic-chart" style="width:100%;height:250px;"></div>
    </section>

    <!-- WIN RATE TREND CHART -->
    <section class="section">
        <div class="section-title">Win Rate Trend (Last 30 Days)</div>
        <div id="winrate-chart" style="width:100%;height:250px;"></div>
    </section>

    <!-- INVENTORY AGE DISTRIBUTION CHART -->
    <section class="section">
        <div class="section-title">Inventory Age Distribution</div>
        <div id="inventory-age-chart" style="width:100%;height:250px;"></div>
    </section>

    <!-- DISCLAIMER -->
    <div class="disclaimer">
        <div class="disclaimer-title">‚ö†Ô∏è Data Transparency</div>
        <div class="disclaimer-text">
            Win rates reflect <strong>sold homes only</strong>. Homes still listed may lose money when sold.<br><br>
            <strong>Kaz-era:</strong> <span id="disc-kaz-sold">66</span> sold (<span id="disc-kaz-wr">98.5%</span> win) + <span id="disc-kaz-listed">145</span> listed (<span id="disc-kaz-uw">5</span> underwater)<br>
            <strong>Legacy:</strong> <span id="disc-legacy-sold">118</span> sold (<span id="disc-legacy-wr">55.9%</span> win) + <span id="disc-legacy-listed">455</span> listed (<span id="disc-legacy-uw">184</span> underwater)<br><br>
            <strong>Total underwater exposure from listed homes: <span class="red" id="disc-total-exposure">$4.98M</span></strong>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-brand">Glass House</div>
        <div class="footer-sub">Honest data for $OPEN shareholders ‚Ä¢ No survivorship bias</div>
    </footer>

</div>

<script>
async function loadData() {
    try {
        const r = await fetch('outputs/dashboard_data.json');
        if (!r.ok) return null;
        return await r.json();
    } catch { return null; }
}

function fmt(v) {
    if (Math.abs(v) >= 1e6) return '$' + (v/1e6).toFixed(1) + 'M';
    if (Math.abs(v) >= 1e3) return '$' + (v/1e3).toFixed(1) + 'K';
    return '$' + v.toFixed(0);
}

// Chart theme configuration
const chartLayout = {
    paper_bgcolor: '#0a0a0a',
    plot_bgcolor: '#141414',
    font: { color: '#f5f5f5', family: 'Inter, sans-serif' },
    margin: { t: 20, r: 20, b: 40, l: 50 },
    xaxis: { gridcolor: '#1a1a1a', linecolor: '#1a1a1a', tickfont: { size: 10 } },
    yaxis: { gridcolor: '#1a1a1a', linecolor: '#1a1a1a', tickfont: { size: 10 } }
};

const chartConfig = { displayModeBar: false, responsive: true };

// Daily Revenue Bar Chart
function renderRevenueChart(data) {
    if (!data || !data.dates || data.dates.length === 0) return;

    const target = 6800000; // $6.8M daily target
    const colors = data.revenue.map(v => v >= target ? '#22c55e' : '#f59e0b');

    const traces = [
        {
            x: data.dates,
            y: data.revenue,
            type: 'bar',
            marker: { color: colors },
            hovertemplate: '%{x}<br>$%{y:,.0f}<extra></extra>'
        },
        {
            x: [data.dates[0], data.dates[data.dates.length - 1]],
            y: [target, target],
            type: 'scatter',
            mode: 'lines',
            line: { color: '#f5f5f5', width: 2, dash: 'dash' },
            hoverinfo: 'skip',
            showlegend: false
        }
    ];

    const layout = {
        ...chartLayout,
        showlegend: false,
        yaxis: {
            ...chartLayout.yaxis,
            tickformat: '$.2s'
        },
        annotations: [{
            x: data.dates[data.dates.length - 1],
            y: target,
            text: '$6.8M target',
            showarrow: false,
            xanchor: 'right',
            yanchor: 'bottom',
            font: { size: 10, color: '#a0a0a0' }
        }]
    };

    Plotly.newPlot('revenue-chart', traces, layout, chartConfig);
}

// Toxic Countdown Area Chart
function renderToxicChart(data) {
    if (!data || !data.dates || data.dates.length === 0) return;

    // Split actual data and projection
    const actualDates = data.dates.filter((_, i) => !data.isProjection || !data.isProjection[i]);
    const actualCounts = data.counts.slice(0, actualDates.length);

    const projDates = data.dates.filter((_, i) => data.isProjection && data.isProjection[i]);
    const projCounts = data.counts.slice(actualDates.length);

    // Add last actual point to projection for continuity
    if (actualDates.length > 0 && projDates.length > 0) {
        projDates.unshift(actualDates[actualDates.length - 1]);
        projCounts.unshift(actualCounts[actualCounts.length - 1]);
    }

    const traces = [
        {
            x: actualDates,
            y: actualCounts,
            type: 'scatter',
            mode: 'lines',
            fill: 'tozeroy',
            fillcolor: 'rgba(239, 68, 68, 0.3)',
            line: { color: '#ef4444', width: 2 },
            name: 'Actual',
            hovertemplate: '%{x}<br>%{y} homes<extra></extra>'
        }
    ];

    if (projDates.length > 1) {
        traces.push({
            x: projDates,
            y: projCounts,
            type: 'scatter',
            mode: 'lines',
            line: { color: '#ef4444', width: 2, dash: 'dot' },
            name: 'Projected',
            hovertemplate: '%{x}<br>%{y} homes (projected)<extra></extra>'
        });
    }

    const layout = {
        ...chartLayout,
        showlegend: true,
        legend: { orientation: 'h', x: 0.5, xanchor: 'center', y: 1.05 },
        yaxis: {
            ...chartLayout.yaxis,
            title: { text: 'Toxic Homes', font: { size: 10, color: '#666666' } }
        }
    };

    Plotly.newPlot('toxic-chart', traces, layout, chartConfig);
}

// Win Rate Trend Line Chart
function renderWinRateChart(data) {
    if (!data || !data.dates || data.dates.length === 0) return;

    const traces = [
        {
            x: data.dates,
            y: data.kazEra,
            type: 'scatter',
            mode: 'lines+markers',
            line: { color: '#22c55e', width: 2 },
            marker: { size: 4 },
            name: 'Kaz-Era',
            hovertemplate: '%{x}<br>%{y:.1f}%<extra>Kaz-Era</extra>'
        },
        {
            x: data.dates,
            y: data.legacy,
            type: 'scatter',
            mode: 'lines+markers',
            line: { color: '#f59e0b', width: 2 },
            marker: { size: 4 },
            name: 'Legacy',
            hovertemplate: '%{x}<br>%{y:.1f}%<extra>Legacy</extra>'
        }
    ];

    const layout = {
        ...chartLayout,
        showlegend: true,
        legend: { orientation: 'h', x: 0.5, xanchor: 'center', y: 1.05 },
        yaxis: {
            ...chartLayout.yaxis,
            range: [0, 100],
            ticksuffix: '%',
            title: { text: 'Win Rate', font: { size: 10, color: '#666666' } }
        }
    };

    Plotly.newPlot('winrate-chart', traces, layout, chartConfig);
}

// Inventory Age Distribution Stacked Bar Chart
function renderInventoryAgeChart(data) {
    if (!data) return;

    const categories = ['Kaz-Era', 'Legacy'];
    const ageSegments = [
        { name: 'Fresh (<30d)', key: 'fresh', color: '#22c55e' },
        { name: 'Normal (30-90d)', key: 'normal', color: '#84cc16' },
        { name: 'Stale (90-180d)', key: 'stale', color: '#f59e0b' },
        { name: 'V.Stale (180-365d)', key: 'veryStale', color: '#f97316' },
        { name: 'Toxic (>365d)', key: 'toxic', color: '#ef4444' }
    ];

    const traces = ageSegments.map(seg => ({
        x: categories,
        y: [data.kazEra[seg.key] || 0, data.legacy[seg.key] || 0],
        type: 'bar',
        name: seg.name,
        marker: { color: seg.color },
        hovertemplate: '%{x}<br>' + seg.name + ': %{y}<extra></extra>'
    }));

    const layout = {
        ...chartLayout,
        barmode: 'stack',
        showlegend: true,
        legend: {
            orientation: 'h',
            x: 0.5,
            xanchor: 'center',
            y: 1.1,
            font: { size: 9 }
        },
        yaxis: {
            ...chartLayout.yaxis,
            title: { text: 'Homes', font: { size: 10, color: '#666666' } }
        }
    };

    Plotly.newPlot('inventory-age-chart', traces, layout, chartConfig);
}

function render(data) {
    if (!data) return;
    const d = data.current;
    const kaz = d.kaz_era || {};
    const g = d.guidance || {};
    const toxic = d.toxic || {};
    const v3 = d.v3 || {};

    // Date
    document.getElementById('date').textContent = new Date().toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});

    // V3 Portfolio Data
    if (v3.portfolio) {
        const kazP = v3.portfolio.kaz_era || {};
        const legacyP = v3.portfolio.legacy || {};

        // Kaz-Era
        if (kazP.sold_count) {
            document.getElementById('kaz-sold-count').textContent = kazP.sold_count;
            document.getElementById('kaz-sold-wr').textContent = kazP.sold_win_rate.toFixed(1) + '%';
            document.getElementById('kaz-sold-profit').textContent = fmt(kazP.sold_avg_profit);
            document.getElementById('kaz-sold-total').textContent = '+' + fmt(kazP.sold_total_realized);
        }
        if (kazP.listed_count) {
            document.getElementById('kaz-listed-count').textContent = kazP.listed_count;
            document.getElementById('kaz-listed-above').textContent = kazP.listed_above_water_pct.toFixed(1) + '% (' + kazP.listed_above_water + ')';
            document.getElementById('kaz-listed-uw').textContent = kazP.listed_underwater_pct.toFixed(1) + '% (' + kazP.listed_underwater + ')';
            document.getElementById('kaz-listed-cuts').textContent = kazP.listed_with_cuts_pct.toFixed(1) + '% (' + kazP.listed_with_cuts + ')';
            document.getElementById('kaz-uw-exposure').textContent = '-' + fmt(kazP.listed_underwater_exposure);
        }

        // Legacy
        if (legacyP.sold_count) {
            document.getElementById('legacy-sold-count').textContent = legacyP.sold_count;
            document.getElementById('legacy-sold-wr').textContent = legacyP.sold_win_rate.toFixed(1) + '%';
            document.getElementById('legacy-sold-profit').textContent = fmt(legacyP.sold_avg_profit);
            document.getElementById('legacy-sold-total').textContent = '+' + fmt(legacyP.sold_total_realized);
        }
        if (legacyP.listed_count) {
            document.getElementById('legacy-listed-count').textContent = legacyP.listed_count;
            document.getElementById('legacy-listed-above').textContent = legacyP.listed_above_water_pct.toFixed(1) + '% (' + legacyP.listed_above_water + ')';
            document.getElementById('legacy-listed-uw').textContent = legacyP.listed_underwater_pct.toFixed(1) + '% (' + legacyP.listed_underwater + ')';
            document.getElementById('legacy-listed-cuts').textContent = legacyP.listed_with_cuts_pct.toFixed(1) + '% (' + legacyP.listed_with_cuts + ')';
            document.getElementById('legacy-uw-exposure').textContent = '-' + fmt(legacyP.listed_underwater_exposure);
        }

        // Disclaimer
        document.getElementById('disc-kaz-sold').textContent = kazP.sold_count || 0;
        document.getElementById('disc-kaz-wr').textContent = (kazP.sold_win_rate || 0).toFixed(1) + '%';
        document.getElementById('disc-kaz-listed').textContent = kazP.listed_count || 0;
        document.getElementById('disc-kaz-uw').textContent = kazP.listed_underwater || 0;
        document.getElementById('disc-legacy-sold').textContent = legacyP.sold_count || 0;
        document.getElementById('disc-legacy-wr').textContent = (legacyP.sold_win_rate || 0).toFixed(1) + '%';
        document.getElementById('disc-legacy-listed').textContent = legacyP.listed_count || 0;
        document.getElementById('disc-legacy-uw').textContent = legacyP.listed_underwater || 0;
        const totalExposure = (kazP.listed_underwater_exposure || 0) + (legacyP.listed_underwater_exposure || 0);
        document.getElementById('disc-total-exposure').textContent = fmt(totalExposure);
    } else if (kaz.realized) {
        // Fallback to old kaz_era data
        document.getElementById('kaz-sold-count').textContent = kaz.realized.count || 66;
        document.getElementById('kaz-sold-wr').textContent = (kaz.realized.win_rate || 98.5).toFixed(1) + '%';
        document.getElementById('kaz-sold-profit').textContent = fmt(kaz.realized.avg_profit || 44400);
    }

    // V3 Days to Sale by Cohort
    if (v3.days_to_sale && v3.days_to_sale.length > 0) {
        const tbody = document.getElementById('velocity-cohort-table');
        tbody.innerHTML = v3.days_to_sale.map(c => {
            const avgClass = c.avg_days_to_sale < 60 ? 'green' : c.avg_days_to_sale > 300 ? 'red' : c.avg_days_to_sale > 150 ? 'amber' : '';
            return `<tr>
                <td class="name">${c.cohort}</td>
                <td>${c.sold_count}</td>
                <td class="${avgClass}">${Math.round(c.avg_days_to_sale)}</td>
                <td>${Math.round(c.median_days_to_sale)}</td>
            </tr>`;
        }).join('');
    }

    // V3 Cohort Margins
    if (v3.cohort_margins && v3.cohort_margins.length > 0) {
        const tbody = document.getElementById('margin-cohort-table');
        tbody.innerHTML = v3.cohort_margins.map(c => {
            const wrClass = c.win_rate >= 85 ? 'green' : c.win_rate >= 50 ? 'amber' : 'red';
            const marginClass = c.contribution_margin >= 8 ? 'green' : c.contribution_margin >= 0 ? '' : 'red';
            const profitClass = c.avg_profit >= 30000 ? 'green' : c.avg_profit >= 0 ? '' : 'red';
            return `<tr>
                <td class="name">${c.cohort}</td>
                <td>${c.sold_count}</td>
                <td class="${wrClass}">${c.win_rate.toFixed(1)}%</td>
                <td class="${marginClass}">${c.contribution_margin.toFixed(1)}%</td>
                <td class="${profitClass}">${fmt(c.avg_profit)}</td>
            </tr>`;
        }).join('');
    }

    // V3 Price Cut Severity
    if (v3.price_cut_severity && v3.price_cut_severity.length > 0) {
        const tbody = document.getElementById('price-cut-table');
        tbody.innerHTML = v3.price_cut_severity.map(p => {
            const pctClass = p.pct_with_cuts > 90 ? 'red' : p.pct_with_cuts > 50 ? 'amber' : '';
            const belowClass = p.avg_pct_below_list > 10 ? 'red' : p.avg_pct_below_list > 5 ? 'amber' : '';
            const threeClass = p.with_3plus_cuts > 50 ? 'red' : '';
            return `<tr>
                <td class="name">${p.portfolio === 'kaz_era' ? 'Kaz-Era' : 'Legacy'}</td>
                <td>${p.with_1_cut}</td>
                <td>${p.with_2_cuts}</td>
                <td class="${threeClass}">${p.with_3plus_cuts}</td>
                <td class="${pctClass}">${p.pct_with_cuts.toFixed(1)}%</td>
                <td class="${belowClass}">${p.avg_pct_below_list.toFixed(1)}%</td>
            </tr>`;
        }).join('');
    }

    // V3 Underwater Watchlist
    if (v3.underwater_watchlist && v3.underwater_watchlist.length > 0) {
        document.getElementById('uw-count').textContent = v3.underwater_watchlist.length;
        const tbody = document.getElementById('underwater-watchlist');
        tbody.innerHTML = v3.underwater_watchlist.map(h => {
            const statusClass = h.status === 'Distressed' ? 'red' : h.status === 'Concern' ? 'red' : 'amber';
            return `<tr>
                <td class="name">${h.city}, ${h.state}</td>
                <td>${h.days_on_market}</td>
                <td class="red">-${fmt(h.underwater_amount)}</td>
                <td>${h.price_cuts}</td>
                <td class="${statusClass}">${h.status}</td>
            </tr>`;
        }).join('');
    }

    // Q1 Guidance
    if (g.revenue_to_date) {
        document.getElementById('q1-rev').textContent = fmt(g.revenue_to_date);
        document.getElementById('q1-pct').textContent = (g.pct_to_target || 20.1).toFixed(1) + '%';
        document.getElementById('q1-progress').style.width = Math.min(g.pct_to_target || 20.1, 100) + '%';
        document.getElementById('vel-q1-proj').textContent = fmt(g.projected_quarter_revenue || 410000000);
    }

    // Toxic
    if (toxic.remaining_count) {
        document.getElementById('legacy-toxic-remaining').textContent = toxic.remaining_count;
        document.getElementById('legacy-weeks').textContent = '~' + Math.ceil(toxic.weeks_to_clear || 9) + ' wks';
    }

    // Render Charts when trends data is available
    const trends = data.trends || {};

    // Daily Revenue Chart
    if (trends.revenue_chart && trends.revenue_chart.length > 0) {
        renderRevenueChart({
            dates: trends.revenue_chart.map(d => d.date),
            revenue: trends.revenue_chart.map(d => d.revenue)
        });
    }

    // Toxic Countdown Chart
    if (trends.toxic_countdown && trends.toxic_countdown.actual) {
        const tc = trends.toxic_countdown;
        const allDates = [...tc.actual.map(d => d.date), ...(tc.projected || []).map(d => d.date)];
        const allCounts = [...tc.actual.map(d => d.count), ...(tc.projected || []).map(d => d.count)];
        const isProjection = [
            ...tc.actual.map(() => false),
            ...(tc.projected || []).map(() => true)
        ];
        renderToxicChart({ dates: allDates, counts: allCounts, isProjection });
    }

    // Win Rate Trend Chart
    if (trends.win_rate_trend && trends.win_rate_trend.kaz) {
        const wrt = trends.win_rate_trend;
        renderWinRateChart({
            dates: wrt.kaz.map(d => d.date),
            kazEra: wrt.kaz.map(d => d.win_rate),
            legacy: (wrt.legacy || []).map(d => d.win_rate)
        });
    }

    // Inventory Age Distribution - use current inventory data
    if (d.inventory) {
        const inv = d.inventory;
        renderInventoryAgeChart({
            kazEra: { fresh: inv.fresh_count || 0, normal: inv.normal_count || 0, stale: 0, veryStale: 0, toxic: 0 },
            legacy: { fresh: 0, normal: 0, stale: inv.stale_count || 0, veryStale: inv.very_stale_count || 0, toxic: inv.toxic_count || 0 }
        });
    }
}

loadData().then(render);
setInterval(() => loadData().then(render), 300000);

// Screenshot Mode Toggle
function toggleScreenshotMode() {
    const body = document.body;
    const btn = document.getElementById('screenshot-btn');
    body.classList.toggle('screenshot-mode');
    btn.classList.toggle('active');

    if (body.classList.contains('screenshot-mode')) {
        btn.textContent = '‚úï Exit Screenshot Mode';
        // Expand all collapsed sections in screenshot mode
        document.querySelectorAll('.collapsible.collapsed').forEach(section => {
            section.classList.remove('collapsed');
        });
    } else {
        btn.textContent = 'üì∑ Screenshot Mode';
    }
}

// Collapsible Section Toggle
function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        section.classList.toggle('collapsed');
    }
}

// Keyboard shortcut for screenshot mode (Ctrl/Cmd + Shift + S)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
        e.preventDefault();
        toggleScreenshotMode();
    }
});
</script>
</body>
</html>
