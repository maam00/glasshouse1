<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glass House ‚Äî $OPEN Intelligence</title>
    <meta name="description" content="Honest operational intelligence for Opendoor investors. No survivorship bias.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --green: #22c55e;
            --green-dim: rgba(34, 197, 94, 0.15);
            --amber: #f59e0b;
            --amber-dim: rgba(245, 158, 11, 0.15);
            --red: #ef4444;
            --red-dim: rgba(239, 68, 68, 0.15);
            --text: #fafafa;
            --text-muted: #a1a1aa;
            --text-dim: #71717a;
            --border: #27272a;
            --card: #18181b;
            --bg: #09090b;
            --radius: 8px;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 24px;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }
        .green { color: var(--green); }
        .amber { color: var(--amber); }
        .red { color: var(--red); }
        .muted { color: var(--text-muted); }
        .dim { color: var(--text-dim); }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .brand {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 13px;
        }

        .ticker {
            font-family: 'JetBrains Mono', monospace;
            padding: 4px 8px;
            background: var(--card);
            border-radius: 4px;
        }

        .timestamp {
            color: var(--text-muted);
        }

        .screenshot-btn {
            padding: 6px 12px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .screenshot-btn:hover {
            background: var(--border);
            color: var(--text);
        }

        /* Cards */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .card-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Executive Summary */
        .summary-card {
            background: linear-gradient(135deg, var(--card) 0%, rgba(24, 24, 27, 0.8) 100%);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 32px;
        }

        .summary-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 12px;
        }

        .summary-text {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text);
        }

        .summary-text strong {
            color: var(--green);
            font-weight: 600;
        }

        .summary-text .warn {
            color: var(--amber);
        }

        /* Section */
        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-badge {
            font-size: 11px;
            color: var(--text-muted);
            padding: 2px 8px;
            background: var(--bg);
            border-radius: 4px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .metric-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
        }

        .metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Stats List */
        .stats-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(39, 39, 42, 0.5);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 500;
        }

        /* Two Column Layout */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: var(--bg);
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-fill.green { background: var(--green); }
        .progress-fill.amber { background: var(--amber); }
        .progress-fill.red { background: var(--red); }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            text-align: left;
            padding: 12px 8px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-dim);
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 12px 8px;
            border-bottom: 1px solid rgba(39, 39, 42, 0.5);
            font-family: 'JetBrains Mono', monospace;
        }

        tr:last-child td {
            border-bottom: none;
        }

        td.name {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }

        /* Risk Indicators */
        .risk-high { color: var(--red); }
        .risk-medium { color: var(--amber); }
        .risk-low { color: var(--text-muted); }

        .risk-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .risk-dot.high { background: var(--red); }
        .risk-dot.medium { background: var(--amber); }
        .risk-dot.low { background: var(--text-dim); }

        /* Alerts */
        .alert {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 12px;
            border-radius: var(--radius);
            font-size: 13px;
            margin-top: 12px;
        }

        .alert-warn {
            background: var(--amber-dim);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: var(--amber);
        }

        .alert-icon {
            flex-shrink: 0;
        }

        /* Weekly Changes */
        .change-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            font-size: 14px;
        }

        .change-icon {
            flex-shrink: 0;
            width: 20px;
            text-align: center;
        }

        .change-good { color: var(--green); }
        .change-warn { color: var(--amber); }

        /* Inline Watchlist */
        .watchlist-inline {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .watchlist-title {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .watchlist-items {
            font-size: 13px;
            color: var(--text-dim);
        }

        /* Net Position Box */
        .net-position {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
        }

        .net-position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            text-align: center;
        }

        .net-item {
            padding: 8px;
        }

        .net-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 600;
        }

        .net-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Footer */
        .footer {
            margin-top: 48px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .footer-text {
            font-size: 12px;
            color: var(--text-dim);
            text-align: center;
            line-height: 1.8;
        }

        /* Chart Container */
        .chart-container {
            height: 200px;
            margin: 16px 0;
        }

        /* Velocity Stats */
        .velocity-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .velocity-stat {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px;
            text-align: center;
        }

        .velocity-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 600;
        }

        .velocity-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Screenshot Mode */
        .watermark {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 24px;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255,255,255,0.3);
            letter-spacing: 1px;
        }

        body.screenshot-mode header,
        body.screenshot-mode .footer {
            display: none;
        }

        body.screenshot-mode .container {
            padding-top: 16px;
        }

        body.screenshot-mode .watermark {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .two-col, .metrics-grid, .velocity-stats {
                grid-template-columns: 1fr;
            }
            .net-position-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="brand">Glass House</div>
            <div class="header-right">
                <span class="ticker">$OPEN <span id="stock-price">$5.90</span></span>
                <span class="timestamp" id="timestamp">Jan 27, 2026 ‚Ä¢ 6:00 PM EST</span>
                <button class="screenshot-btn" id="screenshot-btn" onclick="toggleScreenshotMode()">üì∑ Screenshot</button>
            </div>
        </header>

        <!-- EXECUTIVE SUMMARY -->
        <div class="summary-card">
            <div class="summary-title">Executive Summary</div>
            <div class="summary-text" id="exec-summary">
                <strong>Kaz-era performing at 95.3% win rate</strong> with $9.7M net position.<br>
                Legacy cleanup on pace ‚Äî 84 toxic remaining, ~9 weeks to clear.<br>
                <span class="warn">Watch: FL/GA underwater elevated (48%, 44%). Q1 guidance at risk.</span>
            </div>
        </div>

        <!-- KAZ-ERA PORTFOLIO -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">Kaz-Era Portfolio</div>
                <div class="section-badge">Acquired Nov 2025+</div>
            </div>

            <div class="card">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="kaz-sold">43</div>
                        <div class="metric-label">Homes Sold</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="kaz-listed">103</div>
                        <div class="metric-label">Homes Listed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value green" id="kaz-net">+$9.7M</div>
                        <div class="metric-label">Net Position</div>
                    </div>
                </div>

                <div class="two-col" style="margin-top: 20px;">
                    <div class="stats-list">
                        <div class="stat-row">
                            <span class="stat-label">Win Rate</span>
                            <span class="stat-value green" id="kaz-wr">95.3%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Avg Profit</span>
                            <span class="stat-value green" id="kaz-profit">$43.2K</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Margin</span>
                            <span class="stat-value" id="kaz-margin">10.7%</span>
                        </div>
                    </div>
                    <div class="stats-list">
                        <div class="stat-row">
                            <span class="stat-label">Above Water</span>
                            <span class="stat-value green" id="kaz-above">97.1% (100)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Underwater</span>
                            <span class="stat-value red" id="kaz-uw">2.9% (3)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Price Cuts</span>
                            <span class="stat-value amber" id="kaz-cuts">35.0% (36)</span>
                        </div>
                    </div>
                </div>

                <div class="net-position" style="margin-top: 20px;">
                    <div class="net-position-grid">
                        <div class="net-item">
                            <div class="net-value green" id="kaz-realized">+$1.9M</div>
                            <div class="net-label">Realized</div>
                        </div>
                        <div class="net-item">
                            <div class="net-value" id="kaz-unrealized">+$7.8M</div>
                            <div class="net-label">Unrealized</div>
                        </div>
                        <div class="net-item">
                            <div class="net-value red" id="kaz-exposure">-$12.2K</div>
                            <div class="net-label">Underwater</div>
                        </div>
                    </div>
                </div>

                <div class="watchlist-inline" id="watchlist-section">
                    <div class="watchlist-title"><span id="uw-count">3</span> homes underwater</div>
                    <div class="watchlist-items" id="watchlist-items">
                        Charlotte NC (-$10.5K, 47 DOM) ‚Ä¢ Maricopa AZ (-$1.6K, 15 DOM) ‚Ä¢ Stone Mountain GA (-$77, 18 DOM)
                    </div>
                </div>
            </div>
        </div>

        <!-- LEGACY PORTFOLIO -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">Legacy Portfolio</div>
                <div class="section-badge">Pre-Kaz</div>
            </div>

            <div class="card">
                <div class="two-col">
                    <div>
                        <div class="stats-list">
                            <div class="stat-row">
                                <span class="stat-label">Sold</span>
                                <span class="stat-value" id="legacy-sold">276 homes</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Win Rate</span>
                                <span class="stat-value amber" id="legacy-wr">64.5%</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Avg Profit</span>
                                <span class="stat-value" id="legacy-profit">$23.7K</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Total Realized</span>
                                <span class="stat-value green" id="legacy-total">+$6.5M</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="stats-list">
                            <div class="stat-row">
                                <span class="stat-label">Listed</span>
                                <span class="stat-value" id="legacy-listed">661 homes</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Above Water</span>
                                <span class="stat-value" id="legacy-above">71.3% (471)</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Underwater</span>
                                <span class="stat-value red" id="legacy-uw">28.7% (190)</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Exposure</span>
                                <span class="stat-value red" id="legacy-exposure">-$5.1M</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <div class="stat-row" style="border-bottom: none; padding-bottom: 8px;">
                        <span class="stat-label">Toxic Clearance Progress</span>
                        <span class="stat-value"><span id="toxic-sold">43</span> cleared / <span id="toxic-remaining">84</span> remaining</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill amber" id="toxic-progress" style="width: 34%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted);">
                        <span><span id="toxic-pct">33.9%</span> cleared</span>
                        <span>~<span id="toxic-weeks">9</span> weeks to clear at current pace</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- DAILY OPERATIONS -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">Daily Operations</div>
                <div class="section-badge" id="chart-range">Jan 15-27</div>
            </div>

            <div class="card">
                <div class="chart-container" id="revenue-chart"></div>

                <div class="velocity-stats">
                    <div class="velocity-stat">
                        <div class="velocity-value" id="vel-homes">15.2</div>
                        <div class="velocity-label">homes/day (7d)</div>
                    </div>
                    <div class="velocity-stat">
                        <div class="velocity-value" id="vel-rev">$4.6M</div>
                        <div class="velocity-label">rev/day (7d)</div>
                    </div>
                    <div class="velocity-stat">
                        <div class="velocity-value" id="vel-ytd">$119.7M</div>
                        <div class="velocity-label">Q1 YTD</div>
                    </div>
                    <div class="velocity-stat">
                        <div class="velocity-value amber" id="vel-proj">$409M</div>
                        <div class="velocity-label">projected vs $595M</div>
                    </div>
                </div>

                <div class="alert alert-warn">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <span>Q1 guidance at risk: tracking to <span id="q1-proj">$409M</span> vs $595M target (<span id="q1-pct">68.7%</span>)</span>
                </div>
            </div>
        </div>

        <!-- COHORT ANALYSIS -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">Cohort Analysis</div>
            </div>

            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Cohort</th>
                            <th>Sold</th>
                            <th>Win Rate</th>
                            <th>Margin</th>
                            <th>Avg Profit</th>
                            <th>Avg Days</th>
                        </tr>
                    </thead>
                    <tbody id="cohort-table">
                        <tr>
                            <td class="name">New (&lt;90d)</td>
                            <td>70</td>
                            <td class="green">92.9%</td>
                            <td class="green">10.7%</td>
                            <td class="green">$41.9K</td>
                            <td>65</td>
                        </tr>
                        <tr>
                            <td class="name">Mid (90-180d)</td>
                            <td>104</td>
                            <td class="green">84.6%</td>
                            <td>10.0%</td>
                            <td>$36.9K</td>
                            <td>131</td>
                        </tr>
                        <tr>
                            <td class="name">Old (180-365d)</td>
                            <td>100</td>
                            <td class="amber">53.0%</td>
                            <td>5.4%</td>
                            <td>$21.7K</td>
                            <td>262</td>
                        </tr>
                        <tr>
                            <td class="name">Toxic (&gt;365d)</td>
                            <td>43</td>
                            <td class="red">30.2%</td>
                            <td class="red">-4.1%</td>
                            <td class="red">-$12.5K</td>
                            <td>504</td>
                        </tr>
                    </tbody>
                </table>
                <div style="margin-top: 12px; font-size: 13px; color: var(--text-muted);">
                    Clear gradient ‚Äî newer cohorts outperform on every metric. New cohort at 10.7% margin vs toxic at -4.1%.
                </div>
            </div>
        </div>

        <!-- RISK MONITORING -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">Risk Monitoring</div>
            </div>

            <div class="two-col">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Geographic Concentration</div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>State</th>
                                <th>Inv</th>
                                <th>UW</th>
                                <th>Rate</th>
                            </tr>
                        </thead>
                        <tbody id="geo-table">
                            <tr>
                                <td class="name"><span class="risk-dot high"></span>FL</td>
                                <td>85</td>
                                <td>41</td>
                                <td class="red">48.2%</td>
                            </tr>
                            <tr>
                                <td class="name"><span class="risk-dot high"></span>GA</td>
                                <td>102</td>
                                <td>45</td>
                                <td class="red">44.1%</td>
                            </tr>
                            <tr>
                                <td class="name"><span class="risk-dot medium"></span>NC</td>
                                <td>127</td>
                                <td>38</td>
                                <td class="amber">29.9%</td>
                            </tr>
                            <tr>
                                <td class="name"><span class="risk-dot medium"></span>TX</td>
                                <td>89</td>
                                <td>22</td>
                                <td class="amber">24.7%</td>
                            </tr>
                            <tr>
                                <td class="name"><span class="risk-dot low"></span>AZ</td>
                                <td>59</td>
                                <td>12</td>
                                <td>20.3%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Price Cut Severity</div>
                    </div>
                    <div class="stats-list">
                        <div class="stat-row">
                            <span class="stat-label">Kaz-Era with cuts</span>
                            <span class="stat-value amber" id="cuts-kaz">35.0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Kaz-Era avg below list</span>
                            <span class="stat-value" id="cuts-kaz-below">2.3%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Legacy with cuts</span>
                            <span class="stat-value red" id="cuts-legacy">95.6%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Legacy avg below list</span>
                            <span class="stat-value red" id="cuts-legacy-below">11.8%</span>
                        </div>
                    </div>
                    <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--border);">
                        <div style="font-size: 12px; color: var(--text-muted);">3+ cuts (distressed)</div>
                        <div style="margin-top: 8px; font-size: 13px;">
                            Kaz-Era: <span class="green" id="cuts-kaz-3">1</span> home &nbsp;‚Ä¢&nbsp;
                            Legacy: <span class="red" id="cuts-legacy-3">570</span> homes
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-warn" style="margin-top: 0;">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span>FL and GA have elevated underwater rates ‚Äî monitor closely</span>
            </div>
        </div>

        <!-- WEEKLY CHANGES -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">This Week vs Last Week</div>
                <div class="section-badge" id="wow-range">Jan 20-27</div>
            </div>

            <div class="card">
                <div id="weekly-changes">
                    <div class="change-item">
                        <span class="change-icon change-good">‚úì</span>
                        <span>Kaz-era win rate stable (95.3% ‚Üí 95.3%)</span>
                    </div>
                    <div class="change-item">
                        <span class="change-icon change-good">‚úì</span>
                        <span>Toxic inventory down 5 homes (89 ‚Üí 84)</span>
                    </div>
                    <div class="change-item">
                        <span class="change-icon change-good">‚úì</span>
                        <span>Legacy underwater down 8 homes (198 ‚Üí 190)</span>
                    </div>
                    <div class="change-item">
                        <span class="change-icon change-good">‚úì</span>
                        <span>Underwater exposure improved $120K</span>
                    </div>
                    <div class="change-item">
                        <span class="change-icon change-warn">‚ö†Ô∏è</span>
                        <span>Kaz-era underwater +1 home (2 ‚Üí 3) ‚Äî Charlotte added</span>
                    </div>
                    <div class="change-item">
                        <span class="change-icon change-warn">‚ö†Ô∏è</span>
                        <span>Daily velocity below target (15.2 vs 21 needed)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- DATA TRANSPARENCY -->
        <div class="section">
            <div class="card" style="background: var(--bg); border-color: var(--amber); border-style: dashed;">
                <div class="card-header">
                    <div class="card-title" style="color: var(--amber);">‚ö†Ô∏è Data Transparency</div>
                </div>
                <div style="font-size: 13px; line-height: 1.8; color: var(--text-muted);">
                    Win rates reflect sold homes only. Homes still listed may lose money when sold.<br><br>
                    <strong style="color: var(--text);">Kaz-era:</strong> <span id="disc-kaz-sold">43</span> sold (<span id="disc-kaz-wr">95.3%</span> win) + <span id="disc-kaz-listed">103</span> listed (<span id="disc-kaz-uw">3</span> underwater)<br>
                    <strong style="color: var(--text);">Legacy:</strong> <span id="disc-legacy-sold">276</span> sold (<span id="disc-legacy-wr">64.5%</span> win) + <span id="disc-legacy-listed">661</span> listed (<span id="disc-legacy-uw">190</span> underwater)<br><br>
                    Total underwater exposure from listed homes: <span class="red" id="disc-exposure">$5.1M</span>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div class="footer-text">
                Glass House ‚Ä¢ Honest data for $OPEN shareholders ‚Ä¢ No survivorship bias<br>
                Data from Parcl Labs ‚Ä¢ Updated daily ‚Ä¢ Not financial advice
            </div>
        </div>
    </div>

    <!-- Watermark for Screenshot Mode -->
    <div class="watermark">Glass House</div>

<script>
// Chart configuration
const chartLayout = {
    paper_bgcolor: 'transparent',
    plot_bgcolor: 'transparent',
    font: { color: '#a1a1aa', family: 'Inter, sans-serif', size: 11 },
    margin: { t: 10, r: 10, b: 30, l: 50 },
    xaxis: {
        gridcolor: 'rgba(39, 39, 42, 0.5)',
        linecolor: 'transparent',
        tickfont: { size: 10 }
    },
    yaxis: {
        gridcolor: 'rgba(39, 39, 42, 0.5)',
        linecolor: 'transparent',
        tickfont: { size: 10 }
    }
};

const chartConfig = { displayModeBar: false, responsive: true };

function fmt(v) {
    if (v === null || v === undefined) return '-';
    if (Math.abs(v) >= 1e6) return '$' + (v/1e6).toFixed(1) + 'M';
    if (Math.abs(v) >= 1e3) return '$' + (v/1e3).toFixed(1) + 'K';
    return '$' + Math.round(v);
}

function renderRevenueChart(data) {
    if (!data || data.length === 0) return;

    const target = 6800000;
    const dates = data.map(d => d.date);
    const revenue = data.map(d => d.revenue || 0);
    const colors = revenue.map(v => v >= target ? '#22c55e' : '#f59e0b');

    // Calculate proper max for Y axis
    const maxRev = Math.max(...revenue, target);
    const yMax = Math.ceil(maxRev / 5000000) * 5000000 + 2000000;

    const traces = [
        {
            x: dates,
            y: revenue,
            type: 'bar',
            marker: { color: colors, cornerradius: 4 },
            hovertemplate: '%{x}<br>$%{y:,.0f}<extra></extra>'
        },
        {
            x: [dates[0], dates[dates.length - 1]],
            y: [target, target],
            type: 'scatter',
            mode: 'lines',
            line: { color: '#71717a', width: 1, dash: 'dash' },
            hoverinfo: 'skip',
            showlegend: false
        }
    ];

    const layout = {
        ...chartLayout,
        showlegend: false,
        yaxis: {
            ...chartLayout.yaxis,
            tickformat: '$.1s',
            range: [0, yMax]
        },
        annotations: [{
            x: dates[dates.length - 1],
            y: target,
            text: '$6.8M target',
            showarrow: false,
            xanchor: 'right',
            yanchor: 'bottom',
            font: { size: 10, color: '#71717a' }
        }]
    };

    Plotly.newPlot('revenue-chart', traces, layout, chartConfig);
}

async function loadData() {
    try {
        const response = await fetch('outputs/dashboard_data.json');
        return await response.json();
    } catch (e) {
        console.error('Failed to load data:', e);
        return null;
    }
}

function render(data) {
    if (!data) return;
    const d = data.current || {};
    const v3 = d.v3 || {};
    const kazP = v3.portfolio?.kaz_era || {};
    const legacyP = v3.portfolio?.legacy || {};
    const toxic = d.toxic || {};
    const trends = data.trends || {};
    const insights = data.insights || {};

    // Timestamp
    const now = new Date();
    document.getElementById('timestamp').textContent = now.toLocaleDateString('en-US', {
        month: 'short', day: 'numeric', year: 'numeric'
    }) + ' ‚Ä¢ ' + now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

    // Kaz-Era
    if (kazP.sold_count) {
        document.getElementById('kaz-sold').textContent = kazP.sold_count;
        document.getElementById('kaz-listed').textContent = kazP.listed_count || 0;
        document.getElementById('kaz-wr').textContent = kazP.sold_win_rate?.toFixed(1) + '%';
        document.getElementById('kaz-profit').textContent = fmt(kazP.sold_avg_profit);

        const netPos = (kazP.sold_total_realized || 0) + (kazP.listed_above_water || 0) * 30000 - (kazP.listed_underwater_exposure || 0);
        document.getElementById('kaz-net').textContent = '+' + fmt(netPos > 0 ? netPos : kazP.net_position);

        document.getElementById('kaz-above').textContent = (kazP.listed_above_water_pct || 0).toFixed(1) + '% (' + (kazP.listed_above_water || 0) + ')';
        document.getElementById('kaz-uw').textContent = (kazP.listed_underwater_pct || 0).toFixed(1) + '% (' + (kazP.listed_underwater || 0) + ')';
        document.getElementById('kaz-cuts').textContent = (kazP.listed_with_cuts_pct || 0).toFixed(1) + '% (' + (kazP.listed_with_cuts || 0) + ')';

        document.getElementById('kaz-realized').textContent = '+' + fmt(kazP.sold_total_realized);
        document.getElementById('kaz-exposure').textContent = '-' + fmt(kazP.listed_underwater_exposure);

        document.getElementById('uw-count').textContent = kazP.listed_underwater || 0;

        // Disclaimers
        document.getElementById('disc-kaz-sold').textContent = kazP.sold_count;
        document.getElementById('disc-kaz-wr').textContent = kazP.sold_win_rate?.toFixed(1) + '%';
        document.getElementById('disc-kaz-listed').textContent = kazP.listed_count || 0;
        document.getElementById('disc-kaz-uw').textContent = kazP.listed_underwater || 0;
    }

    // Legacy
    if (legacyP.sold_count) {
        document.getElementById('legacy-sold').textContent = legacyP.sold_count + ' homes';
        document.getElementById('legacy-listed').textContent = legacyP.listed_count + ' homes';
        document.getElementById('legacy-wr').textContent = legacyP.sold_win_rate?.toFixed(1) + '%';
        document.getElementById('legacy-profit').textContent = fmt(legacyP.sold_avg_profit);
        document.getElementById('legacy-total').textContent = '+' + fmt(legacyP.sold_total_realized);
        document.getElementById('legacy-above').textContent = (legacyP.listed_above_water_pct || 0).toFixed(1) + '% (' + (legacyP.listed_above_water || 0) + ')';
        document.getElementById('legacy-uw').textContent = (legacyP.listed_underwater_pct || 0).toFixed(1) + '% (' + (legacyP.listed_underwater || 0) + ')';
        document.getElementById('legacy-exposure').textContent = '-' + fmt(legacyP.listed_underwater_exposure);

        document.getElementById('disc-legacy-sold').textContent = legacyP.sold_count;
        document.getElementById('disc-legacy-wr').textContent = legacyP.sold_win_rate?.toFixed(1) + '%';
        document.getElementById('disc-legacy-listed').textContent = legacyP.listed_count || 0;
        document.getElementById('disc-legacy-uw').textContent = legacyP.listed_underwater || 0;
        document.getElementById('disc-exposure').textContent = fmt(legacyP.listed_underwater_exposure);
    }

    // Toxic
    if (toxic.remaining_count) {
        const sold = toxic.sold_count || 43;
        const remaining = toxic.remaining_count || 84;
        const pct = (sold / (sold + remaining) * 100).toFixed(1);
        document.getElementById('toxic-sold').textContent = sold;
        document.getElementById('toxic-remaining').textContent = remaining;
        document.getElementById('toxic-pct').textContent = pct + '%';
        document.getElementById('toxic-weeks').textContent = Math.ceil(toxic.weeks_to_clear || 9);
        document.getElementById('toxic-progress').style.width = pct + '%';
    }

    // Underwater watchlist
    const watchlist = v3.underwater_watchlist || [];
    if (watchlist.length > 0) {
        const items = watchlist.map(h =>
            `${h.city} ${h.state} (-${fmt(h.underwater_amount)}, ${h.days_on_market} DOM)`
        ).join(' ‚Ä¢ ');
        document.getElementById('watchlist-items').textContent = items;
        document.getElementById('uw-count').textContent = watchlist.length;
    }

    // Cohort table
    const cohorts = [
        ...(v3.days_to_sale || []).map((d, i) => ({
            ...d,
            ...(v3.cohort_margins?.[i] || {})
        }))
    ];
    if (cohorts.length > 0) {
        document.getElementById('cohort-table').innerHTML = cohorts.map(c => {
            const wrClass = c.win_rate >= 85 ? 'green' : c.win_rate >= 50 ? 'amber' : 'red';
            const marginClass = c.contribution_margin >= 8 ? 'green' : c.contribution_margin >= 0 ? '' : 'red';
            const profitClass = c.avg_profit >= 30000 ? 'green' : c.avg_profit >= 0 ? '' : 'red';
            return `<tr>
                <td class="name">${c.cohort}</td>
                <td>${c.sold_count}</td>
                <td class="${wrClass}">${c.win_rate?.toFixed(1)}%</td>
                <td class="${marginClass}">${c.contribution_margin?.toFixed(1)}%</td>
                <td class="${profitClass}">${fmt(c.avg_profit)}</td>
                <td>${Math.round(c.avg_days_to_sale || 0)}</td>
            </tr>`;
        }).join('');
    }

    // Price cuts
    const priceCuts = v3.price_cut_severity || [];
    const kazCuts = priceCuts.find(p => p.portfolio === 'kaz_era') || {};
    const legacyCuts = priceCuts.find(p => p.portfolio === 'legacy') || {};

    if (kazCuts.pct_with_cuts) {
        document.getElementById('cuts-kaz').textContent = kazCuts.pct_with_cuts.toFixed(1) + '%';
        document.getElementById('cuts-kaz-below').textContent = (kazCuts.avg_pct_below_list || 0).toFixed(1) + '%';
        document.getElementById('cuts-kaz-3').textContent = kazCuts.with_3plus_cuts || 0;
    }
    if (legacyCuts.pct_with_cuts) {
        document.getElementById('cuts-legacy').textContent = legacyCuts.pct_with_cuts.toFixed(1) + '%';
        document.getElementById('cuts-legacy-below').textContent = (legacyCuts.avg_pct_below_list || 0).toFixed(1) + '%';
        document.getElementById('cuts-legacy-3').textContent = legacyCuts.with_3plus_cuts || 0;
    }

    // Revenue chart
    if (trends.revenue_chart && trends.revenue_chart.length > 0) {
        renderRevenueChart(trends.revenue_chart);
    }

    // Velocity stats
    const vel = d.velocity || {};
    if (vel.sales_per_day_avg) {
        document.getElementById('vel-homes').textContent = vel.sales_per_day_avg.toFixed(1);
    }

    // Guidance
    const g = d.guidance || {};
    if (g.revenue_to_date) {
        document.getElementById('vel-ytd').textContent = fmt(g.revenue_to_date);
        document.getElementById('vel-proj').textContent = fmt(g.projected_quarter_revenue || 409000000);
        document.getElementById('q1-proj').textContent = fmt(g.projected_quarter_revenue || 409000000);
        document.getElementById('q1-pct').textContent = ((g.projected_quarter_revenue || 409000000) / 595000000 * 100).toFixed(1) + '%';
    }

    // Weekly changes from insights
    if (insights.summary) {
        // Could parse and display, but keeping static for now
    }
}

function toggleScreenshotMode() {
    document.body.classList.toggle('screenshot-mode');
    const btn = document.getElementById('screenshot-btn');
    if (document.body.classList.contains('screenshot-mode')) {
        btn.textContent = '‚úï Exit';
    } else {
        btn.textContent = 'üì∑ Screenshot';
    }
}

document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
        e.preventDefault();
        toggleScreenshotMode();
    }
});

loadData().then(render);
setInterval(() => loadData().then(render), 300000);
</script>
</body>
</html>
